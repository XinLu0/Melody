<!DOCTYPE html>
<html lang="en">
  <head>
<?php 
  		/* 
  		Template Name: adminTable
  		*/ 
function getAllTeacherMemberID(){
	global $wpdb;
	$result = $wpdb->get_results( "SELECT Member FROM Teacher_infor ");
	$mList;
	$size = sizeof($result);
	for($x=0;$x<$size;$x++){
		$mList[$x]=$result[$x]->Member;
	}
	return $mList;

}
function getNameByMemberID($memberID){
	global $wpdb;
	$result = $wpdb->get_results( "SELECT Name FROM Teacher_infor WHERE Member=".$memberID);
	return $result[0]->Name;
}
function getTotalItemNumber(){
	global $wpdb;
	$sum = $wpdb->get_results("SELECT * FROM `Melody_items` ");

	return sizeof($sum);
}
function getNumOfItemByItemIDAndMemeberID($memberID, $item_no){
				global $wpdb;
				global $dateFrom;
				global $dateTo;
				$sum = $wpdb->get_results("SELECT Number FROM `Melody_performance` WHERE Member =$memberID AND Item_no=$item_no AND dDate >=\" $dateFrom \"AND dDate <=\" $dateTo\"");

				
				if(sizeof($sum)==0)
					return 0;
				else 
				{
					$result;
					for($x=0;$x<sizeof($sum);$x++){
						$result = $result+ $sum[$x]->Number;
						
					}
					return $result;
				}
}
function getItemPriceByItemID($item_id)
{
	global $wpdb;
	$sum = $wpdb->get_results("SELECT Price
FROM `Melody_items` WHERE item_no =$item_id");
return $sum[0]->Price;
}
$dateFrom;
$dateTo;
function getDatefromToByCurrent(){
	$currentDate =date('Y-m-d');
	$currentMonth = substr($currentDate,5,2);
	$nextMonth = $currentMonth+1;
	if($nextMonth>12)$nextMonth="01";
	else if($nextMonth<10)$nextMonth="0".$nextMonth;
	global $dateFrom;
	global $dateTo;
	$dateFrom = substr($currentDate,0,7)."-01";
	$dateTo = substr($currentDate,0,4)."-".$nextMonth."-01";
}
$totalItemNumber = getTotalItemNumber();
getDatefromToByCurrent();
?>
</head>
<body>

<p>Click the button to sort the table alphabetically, by name:</p>
<p><button onclick="sortTable()">Sort</button></p>

<table id="myTable">
  <tr>
    <th>Name</th>
    <?php
    for($i=1; $i<=$totalItemNumber;$i++){
    echo "<th>Item$i</th>
    ";
}
    ?>
    <th>Total</th>
  </tr>
  <?php
  $list = getAllTeacherMemberID();
  	for($x=0; $x < sizeof($list);$x++){
  		$name = getNameByMemberID($list[$x]);
  		$sale = 0;
  		echo "<td>$name</td>";
  		for($i=1; $i<=$totalItemNumber;$i++){
  		$num =getNumOfItemByItemIDAndMemeberID($list[$x],$i);
  		echo "<td>$num</td>";
  		$price = getItemPriceByItemID($i);
  		$sale = $sale+$price*$num;
  	}
  	echo"<td>$sale</td>";
  echo"</tr>";
  }
  ?>
  
</table>
<script>
function sortTable() {
  var table, rows, switching, i, x, y, shouldSwitch,numOfCol;
  table = document.getElementById("myTable");
  switching = true;
  /*Make a loop that will continue until
  no switching has been done:*/
  while (switching) {
    //start by saying: no switching is done:
    switching = false;
    rows = table.getElementsByTagName("TR");
    numOfCol = table.rows[0].cells.length;

    /*Loop through all table rows (except the
    first, which contains table headers):*/
    for (i = 1; i < (rows.length - 1); i++) {
      //start by saying there should be no switching:
      shouldSwitch = false;
      /*Get the two elements you want to compare,
      one from current row and one from the next:*/
      x = rows[i].getElementsByTagName("TD")[numOfCol-1];
      y = rows[i + 1].getElementsByTagName("TD")[numOfCol-1];
      //check if the two rows should switch place:
      if (parseInt(x.innerHTML) < parseInt(y.innerHTML)) {
        //if so, mark as a switch and break the loop:
        shouldSwitch= true;
        break;
      }
    }
    if (shouldSwitch) {
      /*If a switch has been marked, make the switch
      and mark that a switch has been done:*/
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
    }
  }
}
</script>
</body>
</html>
